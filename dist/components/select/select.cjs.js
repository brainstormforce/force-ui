"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("react/jsx-runtime"),e=require("react"),h=require("../../utilities/functions.cjs.js"),Q=require("lucide-react"),j=require("@floating-ui/react"),de=require("nanoid"),fe=require("../toaster/utils.cjs.js"),l=require("./component-style.cjs.js"),Y=require("./utils.cjs.js"),pe=require("../../utilities/hooks.cjs.js"),me=require("../badge/badge.cjs.js"),xe=require("../loader/loader.cjs.js"),ne=e.createContext({}),X=()=>e.useContext(ne),Z=e.forwardRef(({children:s,icon:u=null,placeholder:i="Select an option",optionIcon:V=null,render:d,label:f,className:R,...E},p)=>{const{sizeValue:C,getReferenceProps:P,getValues:I,selectId:M,refs:D,isOpen:v,multiple:o,combobox:z,setSelected:L,onChange:k,isControlled:F,disabled:r,by:N}=X(),q={sm:"xs",md:"sm",lg:"md"}[C],A=e.useCallback(()=>{if(u)return u;const a="text-field-placeholder "+l.disabledClassNames.icon;return z?t.jsx(Q.ChevronsUpDown,{className:a}):t.jsx(Q.ChevronDown,{className:a})},[u]),B=e.useCallback(()=>{const a=I();if(!a)return null;if(o)return a.map((y,n)=>t.jsx(me.default,{className:"cursor-default",icon:V,type:"rounded",size:q,onMouseDown:O(y),label:typeof d=="function"?d(y):y.toString(),closable:!0,disabled:r},n));let S=typeof a=="string"?a:"";if(typeof d=="function"&&(S=d(a)),typeof s=="function"&&typeof d!="function"){const y={value:a,...o?{onClose:O(a)}:{}};S=s(y)}return(e.isValidElement(s)||typeof s=="string")&&typeof d!="function"&&(S=s),t.jsx("span",{className:h.cn("truncate",l.sizeClassNames[C].displaySelected,l.disabledClassNames.text),children:S})},[I,r]),O=a=>S=>{S?.preventDefault(),S?.stopPropagation();const y=[...I()??[]],n=y.findIndex(c=>c!==null&&a!==null&&typeof c=="object"?c[N]===a[N]:c===a);n!==-1&&(y.splice(n,1),F||L(y),typeof k=="function"&&k(y))};return t.jsxs("div",{className:"w-full flex flex-col items-start gap-1.5 [&_*]:box-border box-border",children:[!!f&&t.jsx("label",{className:h.cn(l.sizeClassNames[C]?.label,"text-field-label"),htmlFor:M,children:f}),t.jsxs("button",{id:M,ref:fe.mergeRefs(D.setReference,p),className:h.cn("flex items-center justify-between w-full box-border transition-[outline,background-color,color,box-shadow] duration-200 bg-white","outline outline-1 outline-field-border border-none cursor-pointer",!v&&"focus:ring-2 focus:ring-offset-2 focus:outline-focus-border focus:ring-focus [&:hover:not(:focus):not(:disabled)]:outline-border-strong",l.sizeClassNames[C].selectButton,o&&l.sizeClassNames[C].multiSelect,l.disabledClassNames.selectButton,R),tabIndex:0,disabled:r,...E,...P(),children:[t.jsxs("div",{className:h.cn("flex-1 grid items-center justify-start gap-1.5 overflow-hidden",I()&&"flex flex-wrap"),children:[B(),(o?!I()?.length:!I())&&t.jsx("div",{className:h.cn("[grid-area:1/1/2/3] text-field-input px-1",l.sizeClassNames[C].displaySelected,l.disabledClassNames.text),children:i})]}),t.jsx("div",{className:h.cn("flex items-center [&>svg]:shrink-0",l.sizeClassNames[C].icon),children:A()})]})]})});function _({label:s,children:u,className:i,...V}){const{index:d,totalGroups:f}=V,{sizeValue:R}=X(),E={sm:"text-xs",md:"text-xs",lg:"text-sm"};return t.jsxs(e.Fragment,{children:[t.jsxs("div",{className:"flex flex-col",role:"group","aria-label":s,children:[t.jsx("div",{className:h.cn("p-2 font-normal text-text-tertiary",E[R],i),id:`group-${s?.toLowerCase().replace(/\s+/g,"-")}`,children:s}),t.jsx("div",{className:"flex flex-col",role:"presentation","aria-labelledby":`group-${s?.toLowerCase().replace(/\s+/g,"-")}`,children:u})]}),d<f&&!!(u&&e.Children.count(u)>0)&&t.jsx("hr",{className:h.cn(l.optionGroupDividerClassNames,l.optionGroupDividerSizeClassNames[R])})]})}function ee({children:s,className:u}){const{isOpen:i,context:V,refs:d,combobox:f,floatingStyles:R,getFloatingProps:E,sizeValue:p,setSearchKeyword:C,setActiveIndex:P,setSelectedIndex:I,value:M,selected:D,getValues:v,searchKeyword:o,listContentRef:z,by:L,searchPlaceholder:k,activeIndex:F,searchFn:r,debounceDelay:N}=X(),q=e.useMemo(()=>{const n=v();let c=-1;if(n){let w=e.Children.toArray(s);w.length>0&&e.isValidElement(w[0])&&w[0].type===_&&(w=e.Children.toArray(s).map(g=>e.isValidElement(g)?e.Children.toArray(g.props.children):[]).flat()),c=w.findIndex(g=>{if(!e.isValidElement(g))return!1;const T=g.props.value;return typeof T=="object"&&typeof n=="object"?T[L]===n[L]:T===n})}return c},[M,D,s,L]);e.useLayoutEffect(()=>{i||(P(q),I(q))},[q,i]),e.useLayoutEffect(()=>{i&&(f&&[-1,null].includes(F)||P(-1))},[o,i]);const A=e.useMemo(()=>{let n=0,c=0;e.Children.forEach(s,b=>{e.isValidElement(b)&&b.type===_&&e.Children.toArray(b.props.children).some($=>{if(!e.isValidElement($))return!1;if(o&&!r){const H=Y.getTextContent($.props.children)?.toLowerCase(),W=o.toLowerCase();return H.includes(W)}return!0})&&n++}),c=Math.max(0,n-1);let w=0,g=0;const T=b=>{if(!e.isValidElement(b))return null;if(b.type===_){const K=e.Children.map(b.props.children,T);if(!K?.some(W=>W!==null))return null;const H={...b.props,children:K,index:g,totalGroups:c};return g++,e.cloneElement(b,H)}if(o&&!r){const K=Y.getTextContent(b.props?.children)?.toLowerCase(),$=o.toLowerCase();if(!K?.includes($))return null}return e.cloneElement(b,{...b.props,index:w++})};return e.Children.map(s,T)},[o,M,D,s,r]),B=e.Children.count(A);e.useEffect(()=>{z.current=[];let n=e.Children.toArray(s);n&&e.isValidElement(n[0])&&n[0].type===_&&(n=e.Children.toArray(n).map(c=>e.isValidElement(c)?c.props.children:null).filter(Boolean)),e.Children.forEach(n,c=>{if(!e.isValidElement(c))return;const w=Y.getTextContent(c.props?.children)?.toLowerCase();if(o&&!r){const g=o.toLowerCase();if(!w?.includes(g))return}z.current.push(w)})},[o,r]);const[O,a]=e.useState(!1),S=e.useCallback(async()=>{if(!(!r||typeof r!="function"||O)){a(!0);try{await r(o)}catch(n){console.error(n)}finally{a(!1)}}},[o]),y=pe.useDebouncedCallback(S,N);return e.useEffect(()=>{typeof r=="function"&&y()},[y]),t.jsx(t.Fragment,{children:i&&t.jsx(t.Fragment,{children:t.jsx(j.FloatingFocusManager,{context:V,modal:!1,visuallyHiddenDismiss:!0,children:t.jsxs("div",{ref:d.setFloating,className:h.cn("box-border [&_*]:box-border w-full bg-white outline-none shadow-lg outline outline-1 outline-border-subtle",f&&"grid grid-cols-1 grid-rows-[auto_1fr] divide-y divide-x-0 divide-solid divide-border-subtle",l.sizeClassNames[p].dropdown,!f&&"h-auto",f?"overflow-hidden":"overflow-y-auto overflow-x-hidden",u),style:{...R,zIndex:1},...E(),children:[f&&t.jsxs("div",{className:h.cn(l.sizeClassNames[p].searchbarWrapper),children:[O?t.jsx(xe.Loader,{className:l.sizeClassNames[p].searchbarIcon}):t.jsx(Q.Search,{className:h.cn("text-icon-secondary shrink-0",l.sizeClassNames[p].searchbarIcon)}),t.jsx("input",{className:h.cn("px-1 w-full placeholder:text-field-placeholder border-0 focus:outline-none focus:shadow-none",l.sizeClassNames[p].searchbar),type:"search",name:"keyword",placeholder:k,onChange:n=>C(n.target.value),value:o,autoComplete:"off"})]}),t.jsxs("div",{className:h.cn("overflow-y-auto overflow-x-hidden",!f&&"w-full h-full",l.sizeClassNames[p].dropdownItemsWrapper),children:[!!B&&A,!B&&t.jsx("div",{className:h.cn("p-2 text-center font-medium text-field-placeholder",l.selectItemClassNames[p]),children:"No items found"})]})]})})})})}function te({children:s,root:u,id:i}){return t.jsx(j.FloatingPortal,{id:i,root:u,children:s})}function se({value:s,selected:u,children:i,className:V,...d}){const{sizeValue:f,getItemProps:R,onKeyDownItem:E,onClickItem:p,activeIndex:C,selectedIndex:P,updateListRef:I,getValues:M,by:D,multiple:v}=X(),{index:o}=d,z=e.useRef(o),L={sm:"size-4",md:"size-4",lg:"size-5"},k=e.useMemo(()=>{if(!v)return!1;const r=M();return r?r.some(N=>N!==null&&s!==null&&typeof N=="object"?N[D]===s[D]:N===s):!1},[s,M]),F=e.useMemo(()=>typeof u=="boolean"?u:v?k:o===P,[k,P,u]);return t.jsxs("div",{className:h.cn("w-full flex items-center justify-between text-text-primary hover:bg-button-tertiary-hover rounded-md transition-all duration-150 cursor-pointer focus:outline-none focus-within:outline-none outline-none",l.selectItemClassNames[f],o===C&&"bg-button-tertiary-hover",V),ref:r=>{I(o,r)},role:"option",tabIndex:o===C?0:-1,"aria-selected":F&&o===C,...R({onClick(){p(z.current,s)},onKeyDown(r){E(r,z.current,s)}}),children:[t.jsx("span",{className:"w-full truncate",children:i}),F&&t.jsx(Q.CheckIcon,{className:h.cn("text-icon-on-color-disabled",L[f])})]})}const oe=({id:s,size:u="md",value:i,defaultValue:V,onChange:d,by:f="id",children:R,multiple:E=!1,combobox:p=!1,disabled:C=!1,searchPlaceholder:P="Search...",searchFn:I,debounceDelay:M=500})=>{const D=e.useMemo(()=>s||`select-${de.nanoid()}`,[s]),v=e.useMemo(()=>typeof i<"u",[i]),[o,z]=e.useState(V),[L,k]=e.useState(""),F=e.useCallback(()=>v?i:o,[v,i,o]),[r,N]=e.useState(!1),[q,A]=e.useState(null),[B,O]=e.useState(null),a={sm:p?256:172,md:p?256:216,lg:p?256:216},{refs:S,floatingStyles:y,context:n}=j.useFloating({strategy:"fixed",placement:"bottom-start",open:r,onOpenChange:N,whileElementsMounted:j.autoUpdate,middleware:[j.offset(5),j.flip({padding:10}),j.size({apply({rects:m,elements:x,availableHeight:G}){Object.assign(x.floating.style,{maxHeight:`min(${G}px, ${a[u]}px)`,maxWidth:`${m.reference.width}px`})},padding:10})]}),c=e.useRef([]),w=e.useRef([]),g=e.useRef(!1),T=j.useClick(n,{event:"mousedown"}),b=j.useDismiss(n),K=j.useRole(n,{role:"listbox"}),$=j.useListNavigation(n,{listRef:c,activeIndex:q,selectedIndex:B,onNavigate:A,loop:!0}),H=j.useTypeahead(n,{listRef:w,activeIndex:q,selectedIndex:B,onMatch:r?A:O,onTypingChange(m){g.current=m}}),{getReferenceProps:W,getFloatingProps:re,getItemProps:le}=j.useInteractions([b,K,$,T,...p?[]:[H]]),ie=(m,x)=>{const G=[...F()??[]];G.findIndex(J=>J!==null&&x!==null&&typeof J=="object"?J[f]===x[f]:J===x)===-1&&(G.push(x),v||z(G),O(m),S.reference.current.focus(),N(!1),k(""),typeof d=="function"&&d(G))},U=(m,x)=>{if(E)return ie(m,x);O(m),v||z(x),S.reference.current.focus(),N(!1),k(""),typeof d=="function"&&d(x)},ae=e.useCallback((m,x)=>{c.current[m]=x},[]),ce=(m,x)=>{U(m,x)},ue=(m,x,G)=>{m.key==="Enter"&&(m.preventDefault(),U(x,G)),m.key===" "&&!g.current&&(m.preventDefault(),U(x,G))};return t.jsx(ne.Provider,{value:{selectedIndex:B,setSelectedIndex:O,activeIndex:q,setActiveIndex:A,selected:o,setSelected:z,handleSelect:U,combobox:p,sizeValue:u,multiple:E,onChange:d,isTypingRef:g,getItemProps:le,onClickItem:ce,onKeyDownItem:ue,getValues:F,selectId:D,getReferenceProps:W,isOpen:r,value:i,updateListRef:ae,refs:S,listContentRef:w,by:f,getFloatingProps:re,floatingStyles:y,context:n,searchKeyword:L,setSearchKeyword:k,disabled:C,isControlled:v,searchPlaceholder:P,searchFn:I,debounceDelay:M},children:R})};oe.displayName="Select";const he=Object.assign(oe,{Portal:te,Button:Z,Options:ee,Option:se,OptionGroup:_});te.displayName="Select.Portal";Z.displayName="Select.Button";ee.displayName="Select.Options";se.displayName="Select.Option";_.displayName="Select.OptionGroup";exports.SelectButton=Z;exports.SelectItem=se;exports.SelectOptionGroup=_;exports.SelectOptions=ee;exports.SelectPortal=te;exports.default=he;
//# sourceMappingURL=select.cjs.js.map
