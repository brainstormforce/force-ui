{"version":3,"file":"mention-hooks.cjs.js","sources":["../../../../src/components/editor-input/mention-plugin/mention-hooks.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { OptionsArray } from './mention-plugin';\n\nconst mentionsCache = new Map();\n\ntype TBy<T> =\n\tT extends Array<infer U>\n\t\t? U extends Record<string, unknown>\n\t\t\t? keyof U & ( string & {} )\n\t\t\t: string\n\t\t: string;\n\nfunction useMentionLookupService<T = OptionsArray>(\n\toptions: T,\n\tmentionString: string | null,\n\tby: TBy<T> = 'name' as TBy<T>\n): OptionsArray {\n\tconst [ results, setResults ] = useState<OptionsArray>( [] );\n\n\tuseEffect( () => {\n\t\tif ( mentionString === null ) {\n\t\t\tsetResults( [] );\n\t\t\treturn;\n\t\t}\n\n\t\tconst cachedResults = mentionsCache.get( mentionString );\n\t\tif ( cachedResults === null ) {\n\t\t\treturn;\n\t\t} else if ( cachedResults !== undefined ) {\n\t\t\tsetResults( cachedResults );\n\t\t\treturn;\n\t\t}\n\n\t\tmentionsCache.set( mentionString, null );\n\t\tlookupService.search(\n\t\t\toptions,\n\t\t\tmentionString,\n\t\t\t( newResults ) => {\n\t\t\t\tmentionsCache.set( mentionString, newResults );\n\t\t\t\tsetResults( newResults as OptionsArray );\n\t\t\t},\n\t\t\tby\n\t\t);\n\t}, [ mentionString ] );\n\n\treturn results;\n}\n\nconst lookupService = {\n\tsearch<T = OptionsArray>(\n\t\toptions: T,\n\t\tstring: string,\n\t\tcallback: ( result: T ) => void,\n\t\tby: T extends Array<infer U>\n\t\t\t? U extends Record<string, unknown>\n\t\t\t\t? keyof U\n\t\t\t\t: string\n\t\t\t: string\n\t) {\n\t\tsetTimeout( () => {\n\t\t\tif ( ! Array.isArray( options ) ) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst results = options.filter(\n\t\t\t\t( mention: string | Record<string, unknown> ) => {\n\t\t\t\t\tif ( typeof mention === 'string' ) {\n\t\t\t\t\t\treturn mention\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes( string.toLowerCase() );\n\t\t\t\t\t}\n\n\t\t\t\t\tconst strValue = mention?.[ by ]?.toString();\n\t\t\t\t\tif ( ! strValue ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn strValue\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t.includes( string.toLowerCase() );\n\t\t\t\t}\n\t\t\t);\n\t\t\tcallback( results as T );\n\t\t}, 500 );\n\t},\n};\n\nexport default useMentionLookupService;\n"],"names":["mentionsCache","useMentionLookupService","options","mentionString","by","results","setResults","useState","useEffect","cachedResults","lookupService","newResults","string","callback","mention","strValue"],"mappings":"qIAGMA,MAAoB,IAS1B,SAASC,EACRC,EACAC,EACAC,EAAa,OACE,CACf,KAAM,CAAEC,EAASC,CAAW,EAAIC,EAAAA,SAAwB,CAAA,CAAG,EAE3DC,OAAAA,EAAAA,UAAW,IAAM,CAChB,GAAKL,IAAkB,KAAO,CAC7BG,EAAY,CAAA,CAAG,EACf,MAAA,CAGK,MAAAG,EAAgBT,EAAc,IAAKG,CAAc,EACvD,GAAKM,IAAkB,KAEvB,IAAYA,IAAkB,OAAY,CACzCH,EAAYG,CAAc,EAC1B,MAAA,CAGaT,EAAA,IAAKG,EAAe,IAAK,EACzBO,EAAA,OACbR,EACAC,EACEQ,GAAgB,CACHX,EAAA,IAAKG,EAAeQ,CAAW,EAC7CL,EAAYK,CAA2B,CACxC,EACAP,CACD,EAAA,EACE,CAAED,CAAc,CAAE,EAEdE,CACR,CAEA,MAAMK,EAAgB,CACrB,OACCR,EACAU,EACAC,EACAT,EAKC,CACD,WAAY,IAAM,CACjB,GAAK,CAAE,MAAM,QAASF,CAAQ,EAC7B,MAAO,CAAC,EAET,MAAMG,EAAUH,EAAQ,OACrBY,GAA+C,CAC3C,GAAA,OAAOA,GAAY,SACvB,OAAOA,EACL,YAAY,EACZ,SAAUF,EAAO,aAAc,EAGlC,MAAMG,EAAWD,IAAWV,CAAG,GAAG,SAAS,EAC3C,OAAOW,EAGAA,EACL,YAAY,EACZ,SAAUH,EAAO,aAAc,EAJzB,EAIyB,CAEnC,EACAC,EAAUR,CAAa,GACrB,GAAI,CAAA,CAET"}