{"version":3,"file":"mention-hooks.es.js","sources":["../../../../src/components/editor-input/mention-plugin/mention-hooks.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { OptionsArray } from './mention-plugin';\n\nconst mentionsCache = new Map();\n\ntype TBy<T> =\n\tT extends Array<infer U>\n\t\t? U extends Record<string, unknown>\n\t\t\t? keyof U & ( string & {} )\n\t\t\t: string\n\t\t: string;\n\nfunction useMentionLookupService<T = OptionsArray>(\n\toptions: T,\n\tmentionString: string | null,\n\tby: TBy<T> = 'name' as TBy<T>\n): OptionsArray {\n\tconst [ results, setResults ] = useState<OptionsArray>( [] );\n\n\tuseEffect( () => {\n\t\tif ( mentionString === null ) {\n\t\t\tsetResults( [] );\n\t\t\treturn;\n\t\t}\n\n\t\tconst cachedResults = mentionsCache.get( mentionString );\n\t\tif ( cachedResults === null ) {\n\t\t\treturn;\n\t\t} else if ( cachedResults !== undefined ) {\n\t\t\tsetResults( cachedResults );\n\t\t\treturn;\n\t\t}\n\n\t\tmentionsCache.set( mentionString, null );\n\t\tlookupService.search(\n\t\t\toptions,\n\t\t\tmentionString,\n\t\t\t( newResults ) => {\n\t\t\t\tmentionsCache.set( mentionString, newResults );\n\t\t\t\tsetResults( newResults as OptionsArray );\n\t\t\t},\n\t\t\tby\n\t\t);\n\t}, [ mentionString ] );\n\n\treturn results;\n}\n\nconst lookupService = {\n\tsearch<T = OptionsArray>(\n\t\toptions: T,\n\t\tstring: string,\n\t\tcallback: ( result: T ) => void,\n\t\tby: T extends Array<infer U>\n\t\t\t? U extends Record<string, unknown>\n\t\t\t\t? keyof U\n\t\t\t\t: string\n\t\t\t: string\n\t) {\n\t\tsetTimeout( () => {\n\t\t\tif ( ! Array.isArray( options ) ) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst results = options.filter(\n\t\t\t\t( mention: string | Record<string, unknown> ) => {\n\t\t\t\t\tif ( typeof mention === 'string' ) {\n\t\t\t\t\t\treturn mention\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes( string.toLowerCase() );\n\t\t\t\t\t}\n\n\t\t\t\t\tconst strValue = mention?.[ by ]?.toString();\n\t\t\t\t\tif ( ! strValue ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn strValue\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t.includes( string.toLowerCase() );\n\t\t\t\t}\n\t\t\t);\n\t\t\tcallback( results as T );\n\t\t}, 500 );\n\t},\n};\n\nexport default useMentionLookupService;\n"],"names":["mentionsCache","useMentionLookupService","options","mentionString","by","results","setResults","useState","useEffect","cachedResults","lookupService","newResults","string","callback","mention","strValue"],"mappings":";AAGA,MAAMA,wBAAoB,IAAI;AAS9B,SAASC,EACRC,GACAC,GACAC,IAAa,QACE;AACf,QAAM,CAAEC,GAASC,CAAW,IAAIC,EAAwB,CAAA,CAAG;AAE3D,SAAAC,EAAW,MAAM;AAChB,QAAKL,MAAkB,MAAO;AAC7B,MAAAG,EAAY,CAAA,CAAG;AACf;AAAA,IAAA;AAGK,UAAAG,IAAgBT,EAAc,IAAKG,CAAc;AACvD,QAAKM,MAAkB,MAEvB;AAAA,UAAYA,MAAkB,QAAY;AACzC,QAAAH,EAAYG,CAAc;AAC1B;AAAA,MAAA;AAGa,MAAAT,EAAA,IAAKG,GAAe,IAAK,GACzBO,EAAA;AAAA,QACbR;AAAA,QACAC;AAAA,QACA,CAAEQ,MAAgB;AACH,UAAAX,EAAA,IAAKG,GAAeQ,CAAW,GAC7CL,EAAYK,CAA2B;AAAA,QACxC;AAAA,QACAP;AAAA,MACD;AAAA;AAAA,EAAA,GACE,CAAED,CAAc,CAAE,GAEdE;AACR;AAEA,MAAMK,IAAgB;AAAA,EACrB,OACCR,GACAU,GACAC,GACAT,GAKC;AACD,eAAY,MAAM;AACjB,UAAK,CAAE,MAAM,QAASF,CAAQ;AAC7B,eAAO,CAAC;AAET,YAAMG,IAAUH,EAAQ;AAAA,QACvB,CAAEY,MAA+C;AAC3C,cAAA,OAAOA,KAAY;AACvB,mBAAOA,EACL,YAAY,EACZ,SAAUF,EAAO,aAAc;AAGlC,gBAAMG,IAAWD,IAAWV,CAAG,GAAG,SAAS;AAC3C,iBAAOW,IAGAA,EACL,YAAY,EACZ,SAAUH,EAAO,aAAc,IAJzB;AAAA,QAIyB;AAAA,MAEnC;AACA,MAAAC,EAAUR,CAAa;AAAA,OACrB,GAAI;AAAA,EAAA;AAET;"}