"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const C=require("react/jsx-runtime"),u=require("react"),G=require("@lexical/react/LexicalComposerContext"),H=require("@lexical/react/LexicalTypeaheadMenuPlugin"),O=require("./mention-node.cjs.js"),W=require("./mention-option-item.cjs.js"),Y=require("./mention-hooks.cjs.js"),R=require("./mention-combobox.cjs.js"),i=require("lexical"),w=require("@lexical/utils"),F=({optionsArray:_,by:l="name",size:f="md",trigger:A="@",menuComponent:$=R.default,menuItemComponent:h=R.default.Item,autoSpace:x=!0})=>{const a=u.useRef(!1),S=`\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'"~=<>_:;`,m=[A].join(""),p="[^"+m+S+"\\s]",L="(?:\\.[ |$]| |["+S+"]|)",y=75,T=new RegExp(`(^|\\s|\\()([${m}]((?:${p}${L}){0,${y}}))$`),k=50,q=new RegExp(`(^|\\s|\\()([${m}]((?:${p}){0,${k}}))$`),E=t=>{let e=T.exec(t);if(e===null&&(e=q.exec(t)),e!==null){const s=e[1],r=e[3];if(r.length>=0)return{leadOffset:e.index+s.length,matchingString:r,replaceableString:e[2]}}return null},[n]=G.useLexicalComposerContext(),[P,b]=u.useState(null),I=Y.default(_,P,l),D=u.useCallback((t,e,s)=>{n.update(()=>{const r=O.$createMentionNode(t.data,l,f);e&&e.replace(r),s()})},[n]),d=u.useMemo(()=>I.map(t=>new W.default(t)),[n,I]),N=u.useCallback(t=>{if(!x)return!1;const{key:e,ctrlKey:s,metaKey:r}=t;if(s||r||e===" "||e.length>1||a.current)return a.current&&(a.current=!1),!1;const o=i.$getSelection(),{focus:c,anchor:g}=o,[M]=o.getNodes();if(!g||!c||g?.key!==c?.key||g?.offset!==c?.offset||!M)return!1;if(O.$isMentionNode(M)){const K=i.$createTextNode(" ");return M.insertAfter(K),!0}return!1},[n,A,x]),j=u.useCallback(t=>{const{key:e}=t;return e==="Backspace"?(a.current=!0,!0):!1},[a]);return u.useEffect(()=>{if(n)return w.mergeRegister(n.registerCommand(i.KEY_DOWN_COMMAND,N,i.COMMAND_PRIORITY_LOW),n.registerCommand(i.KEY_BACKSPACE_COMMAND,j,i.COMMAND_PRIORITY_LOW))},[n,N]),C.jsx(H.LexicalTypeaheadMenuPlugin,{onQueryChange:b,onSelectOption:D,triggerFn:E,options:d,menuRenderFn:(t,{selectedIndex:e,selectOptionAndCleanUp:s,setHighlightedIndex:r})=>t.current&&d?.length?C.jsx($,{size:f,children:d.map((o,c)=>C.jsx(h,{ref:o.ref,size:f,selected:c===e,onMouseEnter:()=>{r(c)},onClick:()=>s(o),children:typeof o.data=="string"?o.data:o.data?.[l]},c))}):null})};exports.default=F;
//# sourceMappingURL=mention-plugin.cjs.js.map
